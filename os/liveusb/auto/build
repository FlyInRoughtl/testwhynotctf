#!/usr/bin/env bash
set -euo pipefail

# Guard against recursive invocation: lb build executes auto/build.
# Use an absolute lock file because live-build may change CWD.
ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
LOCK_FILE="${ROOT_DIR}/.auto-build.lock"
if [ -f "$LOCK_FILE" ]; then
  exit 0
fi
touch "$LOCK_FILE"
trap 'rm -f "$LOCK_FILE"' EXIT

lb build
